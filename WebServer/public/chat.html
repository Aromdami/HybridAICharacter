<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>채팅 페이지</title>
  <style>
    </style>
  <link href="stylesheets/UI.css" rel="stylesheet" type="text/css">
  <link href="stylesheets/chatBox.css" rel="stylesheet" type="text/css">
  <link href="stylesheets/style.css" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
  
  
  <script src="Build/Downloads.loader.js"></script>
 
  <script defer src="/socket.io/socket.io.js"></script>
  <script defer src="javascripts/script.js"></script>
  <script defer src="javascripts/login.js"></script>
  <script defer src ="javascripts/unity.js"></script>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  
  
</head>

<body>
  <!--테스트용 로그인 시스템-->
  <div class = "upperBar">
    <div class = "testLogin">
     <ul>현재 이름</ul>
     <ul id = "username"></ul> 
    </div>
    <div>
      <button onClick = "startTalk()">캐릭터 강제동작 (대화)</button>
      <button onClick = "stopTalk()">캐릭터 강제동작 (정지)</button>
      <button onClick = "untPause()">캐릭터 강제 정지</button>
    </div>
  </div>

  <div id = "chatUI">
    <div class = "sideBar">
      <div class = "sTitle">채팅방 리스트</div>
      <div id = "chatRooms">
        <button class = "CR ON" data-id = "1"> 채팅방 1번</button>
        <span class= "CRstat ON" data-id = "1">●</span>
        <button class = "CR" data-id = "2"> 채팅방 2번</button>
        <span class= "CRstat OFF" data-id = "2">●</span>
        <button class = "CR" data-id = "3"> 채팅방 3번</button>
        <span class= "CRstat OFF" data-id = "3">●</span>
      </div>
      
      <div class = "sTitle">가상 캐릭터</div>
      <div class = "character">
        <canvas id="unity-canvas" 
          width=175 height=200 
          style="width: 175px; height: 200px; background: #231F20">
        </canvas>
        <div id="unity-loading-bar">
          <div id="unity-logo"></div>
          <div id="unity-progress-bar-empty">
            <div id="unity-progress-bar-full"></div>
          </div>
        </div>
        <div id="unity-mobile-warning">
          WebGL builds are not supported on mobile devices.
        </div>
        <div id="unity-footer">
          <div id="unity-build-title">New_3d_bot</div>
        </div>
      </div>
  
    </div>
    <!--채팅 창 및 버튼-->

    <div class = "chatBox">
      <div class = "sTitle" id = "chatTitle">채팅방 1번</div>
      <div class = "outputBox">
        <ul id = "chatlog"></ul>
      </div>
      <div class = "inputBox">
        <form id = "submitter" action = "">
          <input input input id = "chat" autocomplete = "off"></input>
          <button class = "sendButton">보내기</button>
        </form>
      </div>
    </div>
  </div>

</body>


<script>
  var unitySetup = {
      dataUrl: "Build/Downloads.data",
      frameworkUrl: "Build/Downloads.framework.js",
      codeUrl: "Build/Downloads.wasm",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "New_3d_bot",
      productVersion: "0.1",
      // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
      // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
    };
  var buildURL = "../Build";
  var loaderURL = buildURL + "/Downloads.loader.js";
  var unityContainer = document.querySelector("#character");
  var canvas = document.querySelector("#unity-canvas");

  var loadingBar = document.querySelector("#unity-loading-bar");
  var progressBarFull = document.querySelector("#unity-progress-bar-full");

  var mainScript = document.createElement("script");

  var charInstance = null;

  mainScript.src = loaderURL;
  mainScript.onload = () => {
      createUnityInstance
      (
          canvas, 
          unitySetup, 
          (progress) =>{progressBarFull.style.width = 100 * progress + "%";}
      ).then((unityInstance) =>{ 
          charInstance = unityInstance;
          loadingBar.style.display = "none";
          }
      ).catch((message) => {alert(message);});
  }

  document.body.appendChild(mainScript);

  createUnityInstance(document.querySelector("#unity-canvas"), unitySetup);

  function stopTalk()
  {
      charInstance.SendMessage("CCavatar", "changeAnimation", 1);
  }
  function startTalk()
  {
      charInstance.SendMessage("CCavatar", "changeAnimation", 0);
  }
  function untPause()
  {
      charInstance.SendMessage("CCavatar", 0);
  }
</script>